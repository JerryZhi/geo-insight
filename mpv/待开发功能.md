# 待开发功能

## ✅ 已完成功能
1. ✅ 修复文件上传时弹窗两次的bug - 通过防抖机制和事件冒泡控制解决
2. ✅ 记忆近期上传的文件（最多3个），方便用户快速重选 - 新增upload_history表和重用功能
3. ✅ 提供文本框的提示词输入方案，可以直接粘贴提示词，每行一个提示词 - 新增文本输入模式

## 🔄 待开发功能
4. result文件记录完整的response而不是截断200字符
5. 允许同时使用多个api，选择多个api时，每个api每个prompts都进行一次查询，并在result中记录每行采用的api是什么
6. 加入失败重连机制，对于失败的调用，在所有查询完成后重试，最多重试次数：3

## 📝 功能实现详情

### 1. 修复文件上传弹窗两次bug
- **问题**：点击上传区域时文件选择对话框弹出两次
- **解决方案**：
  - 添加防抖机制（500ms延迟）
  - 使用事件冒泡控制，避免按钮和区域重复触发
  - 精确控制事件监听器

### 2. 文件上传记忆功能
- **数据库**：新增`upload_history`表记录文件上传历史
- **功能**：
  - 自动记录每次上传的文件信息（原始文件名、存储文件名、大小、提示词数量、上传时间）
  - 在新建任务页面显示最近3个上传文件
  - 支持一键重新使用历史文件
  - 自动清理旧记录（保留最近10个）

### 3. 文本框提示词输入
- **功能**：
  - 新增文本输入模式，与文件上传并列
  - 支持直接粘贴提示词，每行一个
  - 实时显示行数统计和限制提醒
  - 最多支持1000条提示词
  - 自动过滤空行

### 技术改进
- **路由优化**：新增`/upload_text`和`/reuse_upload/<int:upload_id>`路由
- **数据库方法**：新增文件历史相关的CRUD操作
- **前端交互**：改进UI设计，支持多种输入方式切换
- **错误处理**：增强文件验证和错误提示
